import{S as t,i as e,s as n,c as s,e as o,t as r,a as c,b as a,d as l,f as i,g as h,h as u,j as f,k as d,l as m,m as p,n as v,o as $,u as g,p as w,q as E,r as b,v as y,w as k,x as j,y as I,z as O,A as x,B as D,C as S,D as A,E as T,F as N,G as M,H as P,I as V,J as C,K as R,L,M as U,N as H,O as q,P as z,Q as _,R as B,T as J,U as F}from"./vendor.bdf1f4d8.js";function G(t){let e,n,y,k,j,I,O,x;const D=t[3].default,S=s(D,t,t[2],null);return{c(){e=o("div"),n=o("div"),y=r(t[1]),k=c(),j=o("div"),S&&S.c(),this.h()},l(s){e=a(s,"DIV",{class:!0,tabindex:!0});var o=l(e);n=a(o,"DIV",{class:!0,"data-active":!0});var r=l(n);y=i(r,t[1]),r.forEach(h),k=u(o),j=a(o,"DIV",{class:!0});var c=l(j);S&&S.l(c),c.forEach(h),o.forEach(h),this.h()},h(){f(n,"class","ovo-btn"),f(n,"data-active",t[0]),f(j,"class","details ovo-bg ovo-bdr svelte-h8pe61"),d(j,"open",t[0]),f(e,"class","drop svelte-h8pe61"),f(e,"tabindex","0")},m(s,o){m(s,e,o),p(e,n),p(n,y),p(e,k),p(e,j),S&&S.m(j,null),I=!0,O||(x=[v(n,"click",t[4]),v(e,"blur",t[5])],O=!0)},p(t,[e]){(!I||2&e)&&$(y,t[1]),(!I||1&e)&&f(n,"data-active",t[0]),S&&S.p&&(!I||4&e)&&g(S,D,t,t[2],I?e:-1,null,null),1&e&&d(j,"open",t[0])},i(t){I||(w(S,t),I=!0)},o(t){E(S,t),I=!1},d(t){t&&h(e),S&&S.d(t),O=!1,b(x)}}}function W(t,e,n){let{$$slots:s={},$$scope:o}=e,{title:r=""}=e,{open:c=!1}=e;return t.$$set=t=>{"title"in t&&n(1,r=t.title),"open"in t&&n(0,c=t.open),"$$scope"in t&&n(2,o=t.$$scope)},[c,r,o,s,()=>n(0,c=!c),()=>n(0,c=!1)]}class Y extends t{constructor(t){super(),e(this,t,W,G,n,{title:1,open:0})}}function K(t){let e,n;return{c(){e=o("div"),n=r("加载中"),this.h()},l(t){e=a(t,"DIV",{class:!0});var s=l(e);n=i(s,"加载中"),s.forEach(h),this.h()},h(){f(e,"class","svelte-q18c5f")},m(t,s){m(t,e,s),p(e,n)},p:y,i:y,o:y,d(t){t&&h(e)}}}class Q extends t{constructor(t){super(),e(this,t,null,K,n,{})}}function X(t,e,n){const s=t.slice();return s[8]=e[n],s}function Z(t){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function tt(t){let e,n=t[7].temoji,s=[];for(let o=0;o<n.length;o+=1)s[o]=et(X(t,n,o));return{c(){e=o("ul");for(let t=0;t<s.length;t+=1)s[t].c();this.h()},l(t){e=a(t,"UL",{class:!0});var n=l(e);for(let e=0;e<s.length;e+=1)s[e].l(n);n.forEach(h),this.h()},h(){f(e,"class","ovo-ul svelte-11e5sht")},m(t,n){m(t,e,n);for(let o=0;o<s.length;o+=1)s[o].m(e,null)},p(t,o){if(3&o){let r;for(n=t[7].temoji,r=0;r<n.length;r+=1){const c=X(t,n,r);s[r]?s[r].p(c,o):(s[r]=et(c),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},i:y,o:y,d(t){t&&h(e),A(s,t)}}}function et(t){let e,n,s,c,u,d=t[8].text+"";function $(){return t[3](t[8])}return{c(){e=o("li"),n=r(d),this.h()},l(t){e=a(t,"LI",{title:!0,class:!0});var s=l(e);n=i(s,d),s.forEach(h),this.h()},h(){f(e,"title",s=t[8].title),f(e,"class","svelte-11e5sht")},m(t,s){m(t,e,s),p(e,n),c||(u=v(e,"click",$),c=!0)},p(e,n){t=e},d(t){t&&h(e),c=!1,u()}}}function nt(t){let e,n;return e=new Q({}),{c(){k(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,s){I(e,t,s),n=!0},p:y,i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){E(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function st(t){let e,n,s={ctx:t,current:null,token:null,hasCatch:!1,pending:nt,then:tt,catch:Z,value:7,blocks:[,,,]};return D(t[1],s),{c(){e=o("div"),s.block.c(),this.h()},l(t){e=a(t,"DIV",{class:!0});var n=l(e);s.block.l(n),n.forEach(h),this.h()},h(){f(e,"class","emoji svelte-11e5sht")},m(t,o){m(t,e,o),s.block.m(e,s.anchor=null),s.mount=()=>e,s.anchor=null,n=!0},p(e,n){S(s,t=e,n)},i(t){n||(w(s.block),n=!0)},o(t){for(let e=0;e<3;e+=1){const t=s.blocks[e];E(t)}n=!1},d(t){t&&h(e),s.block.d(),s.token=null,s=null}}}function ot(t){let e,n;return e=new Y({props:{title:"表情",$$slots:{default:[st]},$$scope:{ctx:t}}}),{c(){k(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,s){I(e,t,s),n=!0},p(t,[n]){const s={};2048&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){E(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function rt(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(o,r){function c(t){try{l(s.next(t))}catch(e){r(e)}}function a(t){try{l(s.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}l((s=s.apply(t,e||[])).next())}))};let{emoji:o=""}=e;const r=x();function c(t){r("change",t)}const a=function(t){return s(this,void 0,void 0,(function*(){if(!t)throw new Error("no emoji source provided");const e=yield fetch(t);try{if(e.ok){return yield e.json()}}catch(n){throw n}}))}(o);return t.$$set=t=>{"emoji"in t&&n(2,o=t.emoji)},[c,a,o,t=>c(t)]}class ct extends t{constructor(t){super(),e(this,t,rt,ot,n,{emoji:2})}}const at=T(null),lt=T(null);function it(t,e,n){const s=t.slice();return s[5]=e[n],s}function ht(t){let e;return{c(){e=r("没有可以 @ 的人呢")},l(t){e=i(t,"没有可以 @ 的人呢")},m(t,n){m(t,e,n)},p:y,d(t){t&&h(e)}}}function ut(t){let e,n=t[0],s=[];for(let o=0;o<n.length;o+=1)s[o]=ft(it(t,n,o));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=M()},l(t){for(let e=0;e<s.length;e+=1)s[e].l(t);e=M()},m(t,n){for(let e=0;e<s.length;e+=1)s[e].m(t,n);m(t,e,n)},p(t,o){if(3&o){let r;for(n=t[0],r=0;r<n.length;r+=1){const c=it(t,n,r);s[r]?s[r].p(c,o):(s[r]=ft(c),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(t){A(s,t),t&&h(e)}}}function ft(t){let e,n,s,c,u,d,g,w=t[5].name+"",E=t[5].website+"";function b(){return t[3](t[5])}return{c(){e=o("li"),n=r(w),s=r(" ("),c=r(E),u=r(")\n        "),this.h()},l(t){e=a(t,"LI",{class:!0});var o=l(e);n=i(o,w),s=i(o," ("),c=i(o,E),u=i(o,")\n        "),o.forEach(h),this.h()},h(){f(e,"class","ovo-li ovo-ptr")},m(t,o){m(t,e,o),p(e,n),p(e,s),p(e,c),p(e,u),d||(g=v(e,"click",b),d=!0)},p(e,s){t=e,1&s&&w!==(w=t[5].name+"")&&$(n,w),1&s&&E!==(E=t[5].website+"")&&$(c,E)},d(t){t&&h(e),d=!1,g()}}}function dt(t){let e;function n(t,e){return t[0].length?ut:ht}let s=n(t),r=s(t);return{c(){e=o("ul"),r.c(),this.h()},l(t){e=a(t,"UL",{class:!0});var n=l(e);r.l(n),n.forEach(h),this.h()},h(){f(e,"class","ovo-ul svelte-11z2wui")},m(t,n){m(t,e,n),r.m(e,null)},p(t,o){s===(s=n(t))&&r?r.p(t,o):(r.d(1),r=s(t),r&&(r.c(),r.m(e,null)))},d(t){t&&h(e),r.d()}}}function mt(t){let e,n;return e=new Y({props:{title:"@",$$slots:{default:[dt]},$$scope:{ctx:t}}}),{c(){k(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,s){I(e,t,s),n=!0},p(t,[n]){const s={};257&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(w(e.$$.fragment,t),n=!0)},o(t){E(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function pt(t,e,n){let s;N(t,lt,(t=>n(2,s=t)));let o=[];const r=x();function c(t){r("change",t)}return t.$$.update=()=>{5&t.$$.dirty&&s&&(n(0,o=[]),s.forEach((t=>o.push(t))))},[o,c,s,t=>c(t.name)]}class vt extends t{constructor(t){super(),e(this,t,pt,mt,n,{})}}const $t=/[a-zA-Z0-9_\u0392-\u03c9\u00c0-\u00ff\u0600-\u06ff\u0400-\u04ff]+|[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g;let gt;function wt(t){return P(t)}lt.subscribe((t=>gt=t)),P.use({renderer:{paragraph:t=>{let e=!1,n=t;return n=n.replace(/@([\u4e00-\u9fa5]|\w)+ /g,(t=>{e=!0;const n=gt.get(t.slice(1).trim());return`<a href="${(null==n?void 0:n.website)||""}">${t}</a> `})),n=n.replace(/#(\d+|[a-z,0-9]{7}) /g,(t=>(e=!0,`<a href="#ovo-${t.slice(1).trim()}">${t}</a>`))),!!e&&"<p>"+n+"</p>"}}});class Et{static init(t){this.server=t.server,this.timeout=t.timeout}static async postComment(t){const e=new Blob([JSON.stringify(t)],{type:"application/json"}),n=await bt(`${this.server}/comment`,{method:"POST",timeout:this.timeout,body:e});try{if(!n.ok)throw new Error("error posting comment "+t);const e=await n.json();if(null==e?void 0:e.errmsg)throw new Error(e.errmsg)}catch(s){throw s}}static async postReply(t){const e=new Blob([JSON.stringify(t)],{type:"application/json"}),n=await bt(`${this.server}/reply`,{method:"POST",timeout:this.timeout,body:e});try{if(!n.ok)throw new Error("error posting comment "+t);const e=await n.json();if(null==e?void 0:e.errmsg)throw new Error(e.errmsg)}catch(s){throw s}}static async getComments(t){const e=new URLSearchParams;e.set("domain",encodeURIComponent(t.domain)),e.set("path",encodeURIComponent(t.path)),e.set("page",encodeURIComponent(t.page));const n=await bt(`${this.server}/comment?${e.toString()}`,{timeout:this.timeout});try{if(!n.ok)throw new Error("error getting comments "+t);const e=await n.json();if(null==e?void 0:e.errmsg)throw new Error(e.errmsg);return e}catch(s){throw s}}}async function bt(t,e){let n=null;n=setTimeout((()=>{throw n&&(clearTimeout(n),n=null),new Error("timeout")}),e.timeout);const s=await fetch(t,e);return clearTimeout(n),n=null,s}class yt{static init(){this.store=new Map}static on(t,e){this.store||this.init(),this.store.has(t)||this.store.set(t,new Set),this.store.get(t).add(e)}static off(t,e){if(!this.store)throw new Error("nothing to remove");this.store.get(t).delete(e)}static emit(t,...e){if(!this.store)throw new Error("nothing to emit");const n=this.store.get(t);n&&n.forEach((function(t){t(...e)}))}}function kt(t){let e,n,s,g,y,x,D,S,A,T,N,M,P,R,L,U,H,q,z,_,B,J,F,G,W,Y,K,Q,X,Z,tt,et,nt,st,ot=t[8]?"发布中":"发布";return R=new ct({props:{emoji:t[4]}}),R.$on("change",t[12]),z=new vt({}),z.$on("change",t[13]),{c(){e=o("form"),n=o("div"),s=o("input"),g=c(),y=o("input"),x=c(),D=o("input"),S=c(),A=o("textarea"),T=c(),N=o("div"),M=c(),P=o("div"),k(R.$$.fragment),L=c(),U=o("div"),H=r("预览"),q=c(),k(z.$$.fragment),_=c(),B=o("div"),J=r(t[9]),F=c(),G=o("div"),W=c(),Y=o("div"),K=r(t[11]),Q=r(" 字"),X=c(),Z=o("button"),tt=r(ot),this.h()},l(o){e=a(o,"FORM",{class:!0});var r=l(e);n=a(r,"DIV",{class:!0});var c=l(n);s=a(c,"INPUT",{type:!0,placeholder:!0,class:!0}),g=u(c),y=a(c,"INPUT",{type:!0,placeholder:!0,class:!0}),x=u(c),D=a(c,"INPUT",{type:!0,placeholder:!0,class:!0}),c.forEach(h),S=u(r),A=a(r,"TEXTAREA",{placeholder:!0,class:!0}),l(A).forEach(h),T=u(r),N=a(r,"DIV",{class:!0}),l(N).forEach(h),M=u(r),P=a(r,"DIV",{class:!0});var f=l(P);j(R.$$.fragment,f),L=u(f),U=a(f,"DIV",{class:!0,"data-active":!0});var d=l(U);H=i(d,"预览"),d.forEach(h),q=u(f),j(z.$$.fragment,f),_=u(f),B=a(f,"DIV",{class:!0});var m=l(B);J=i(m,t[9]),m.forEach(h),F=u(f),G=a(f,"DIV",{}),l(G).forEach(h),W=u(f),Y=a(f,"DIV",{});var p=l(Y);K=i(p,t[11]),Q=i(p," 字"),p.forEach(h),X=u(f),Z=a(f,"BUTTON",{class:!0,type:!0,"data-disabled":!0});var v=l(Z);tt=i(v,ot),v.forEach(h),f.forEach(h),r.forEach(h),this.h()},h(){f(s,"type","text"),f(s,"placeholder","昵称"),s.required=!0,f(s,"class","svelte-1o8ler7"),f(y,"type","email"),f(y,"placeholder","邮箱"),y.required=!0,f(y,"class","svelte-1o8ler7"),f(D,"type","url"),f(D,"placeholder","网址"),D.required=!0,f(D,"class","svelte-1o8ler7"),f(n,"class","info svelte-1o8ler7"),f(A,"placeholder",t[0]),A.required=!0,f(A,"class","svelte-1o8ler7"),f(N,"class","preview svelte-1o8ler7"),d(N,"open",t[6]),f(U,"class","ovo-btn"),f(U,"data-active",t[6]),f(B,"class","ovo-oa-x"),f(Z,"class","ovo-btn"),f(Z,"type","submit"),f(Z,"data-disabled",t[8]),f(P,"class","action svelte-1o8ler7"),f(e,"class","svelte-1o8ler7")},m(o,r){m(o,e,r),p(e,n),p(n,s),V(s,t[1]),p(n,g),p(n,y),V(y,t[2]),p(n,x),p(n,D),V(D,t[3]),p(e,S),p(e,A),t[19](A),V(A,t[7]),p(e,T),p(e,N),N.innerHTML=t[10],p(e,M),p(e,P),I(R,P,null),p(P,L),p(P,U),p(U,H),p(P,q),I(z,P,null),p(P,_),p(P,B),p(B,J),p(P,F),p(P,G),p(P,W),p(P,Y),p(Y,K),p(Y,Q),p(P,X),p(P,Z),p(Z,tt),et=!0,nt||(st=[v(s,"input",t[16]),v(y,"input",t[17]),v(D,"input",t[18]),v(A,"input",t[20]),v(U,"click",t[21]),v(e,"submit",C(t[14]))],nt=!0)},p(t,[e]){2&e&&s.value!==t[1]&&V(s,t[1]),4&e&&y.value!==t[2]&&V(y,t[2]),8&e&&V(D,t[3]),(!et||1&e)&&f(A,"placeholder",t[0]),128&e&&V(A,t[7]),(!et||1024&e)&&(N.innerHTML=t[10]),64&e&&d(N,"open",t[6]);const n={};16&e&&(n.emoji=t[4]),R.$set(n),(!et||64&e)&&f(U,"data-active",t[6]),(!et||512&e)&&$(J,t[9]),(!et||2048&e)&&$(K,t[11]),(!et||256&e)&&ot!==(ot=t[8]?"发布中":"发布")&&$(tt,ot),(!et||256&e)&&f(Z,"data-disabled",t[8])},i(t){et||(w(R.$$.fragment,t),w(z.$$.fragment,t),et=!0)},o(t){E(R.$$.fragment,t),E(z.$$.fragment,t),et=!1},d(n){n&&h(e),t[19](null),O(R),O(z),nt=!1,b(st)}}}function jt(t,e,n){let s,o;N(t,at,(t=>n(15,o=t)));var r=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(o,r){function c(t){try{l(s.next(t))}catch(e){r(e)}}function a(t){try{l(s.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}l((s=s.apply(t,e||[])).next())}))};let c,{placeholder:a="说点什么吧~"}=e,{emoji:l=""}=e,i=!1,h=!1,u="",f="",d="",{name:m=""}=e,{email:p=""}=e,{website:v=""}=e;function $(t){const e=c.selectionStart,s=c.selectionEnd;n(7,f=f.substring(0,e)+t+f.substring(s,f.length)),n(5,c.selectionStart=e+l.length,c),n(5,c.selectionEnd=e+l.length,c),c.focus()}yt.on("refresh",(function(){at.update((()=>null)),n(5,c.placeholder="说点什么吧～",c),n(5,c.value="",c),n(9,u=""),n(6,i=!1)})),yt.on("ref",(function(t){$(`#${t} `)}));return t.$$set=t=>{"placeholder"in t&&n(0,a=t.placeholder),"emoji"in t&&n(4,l=t.emoji),"name"in t&&n(1,m=t.name),"email"in t&&n(2,p=t.email),"website"in t&&n(3,v=t.website)},t.$$.update=()=>{128&t.$$.dirty&&n(11,s=function(t){const e=t.match($t);let n=0;if(!e)return 0;for(let s=0;s<e.length;s++)e[s].charCodeAt(0)>=19968?n+=e[s].length:n+=1;return n}(f)),192&t.$$.dirty&&i&&n(10,d=wt(f)),32801&t.$$.dirty&&o&&(n(0,a=`回复#${o.id}`),n(9,u=a),c&&c.focus())},[a,m,p,v,l,c,i,f,h,u,d,s,function(t){$(t.detail.text)},function(t){$(`@${t.detail} `)},function(){return r(this,void 0,void 0,(function*(){if(h)return;let t;if(n(8,h=!0),n(10,d=d||wt(f)),o){const{cid:e,id:n}=o;t={cid:e||n,rid:e?n:null}}const e={name:m,email:p,website:v},s=Object.assign({domain:location.hostname,path:location.pathname,content:d,user:e},t);localStorage.user=JSON.stringify(e);try{o?yield Et.postReply(s):yield Et.postComment(s)}catch(r){return void alert(r.message)}finally{n(8,h=!1)}alert("发布成功 φ(￣∇￣o)"),yt.emit("refresh")}))},o,function(){m=this.value,n(1,m)},function(){p=this.value,n(2,p)},function(){v=this.value,n(3,v)},function(t){R[t?"unshift":"push"]((()=>{c=t,n(5,c)}))},function(){f=this.value,n(7,f)},()=>n(6,i=!i)]}class It extends t{constructor(t){super(),e(this,t,jt,kt,n,{placeholder:0,emoji:4,name:1,email:2,website:3})}}function Ot(t,e){if(t)for(let n=0;n<t.length;n++)e(t[n]),Ot(t[n].children,e)}function xt(t){let e,n,s=t[0]?"到底啦 OvO":"加载中";return{c(){e=o("div"),n=r(s),this.h()},l(t){e=a(t,"DIV",{class:!0});var o=l(e);n=i(o,s),o.forEach(h),this.h()},h(){f(e,"class","ovo-s svelte-1l5g19d")},m(s,o){m(s,e,o),p(e,n),t[2](e)},p(t,[e]){1&e&&s!==(s=t[0]?"到底啦 OvO":"加载中")&&$(n,s)},i:y,o:y,d(n){n&&h(e),t[2](null)}}}function Dt(t,e,n){let s,{done:o=!1}=e;const r=x(),c=new IntersectionObserver((function(t){t[0].intersectionRatio<=.8||r("visiable",t[0])}),{threshold:[.8]});return L((function(){c.observe(s)})),U((function(){c.disconnect()})),t.$$set=t=>{"done"in t&&n(0,o=t.done)},[o,s,function(t){R[t?"unshift":"push"]((()=>{s=t,n(1,s)}))}]}class St extends t{constructor(t){super(),e(this,t,Dt,xt,n,{done:0})}}function At(t,e=!1){const n=new Date(t),s=(new Date).getTime()-n.getTime();if(s<6e4)return`${Math.ceil(s/1e3)} 秒前`;if(s<36e5)return`${Math.ceil(s/6e4)} 分钟前`;if(s<864e5)return`${Math.ceil(s/36e5)} 小时前`;let o=`${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}`;return e&&(o+=` ${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}`),o}function Tt(t,e,n){const s=t.slice();return s[9]=e[n],s[11]=n,s}function Nt(t){let e,n,s=t[0],o=[];for(let c=0;c<s.length;c+=1)o[c]=Mt(Tt(t,s,c));const r=t=>E(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=M()},l(t){for(let e=0;e<o.length;e+=1)o[e].l(t);e=M()},m(t,s){for(let e=0;e<o.length;e+=1)o[e].m(t,s);m(t,e,s),n=!0},p(t,n){if(55&n){let c;for(s=t[0],c=0;c<s.length;c+=1){const r=Tt(t,s,c);o[c]?(o[c].p(r,n),w(o[c],1)):(o[c]=Mt(r),o[c].c(),w(o[c],1),o[c].m(e.parentNode,e))}for(H(),c=s.length;c<o.length;c+=1)r(c);q()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)w(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)E(o[e]);n=!1},d(t){A(o,t),t&&h(e)}}}function Mt(t){var e,n;let s,g,y,x,D,S,A,T,N,M,P,V,C,R,L,U,H,q,z,_,B,J,F,G,W,Y,K,Q,X,Z,tt=(null==(e=t[9].user)?void 0:e.name)+"",et=t[9].id+"",nt=At(t[9].ctime)+"",st=((null==(n=t[9].children)?void 0:n.length)||0)+"",ot=t[9].content+"";function rt(){return t[6](t[9])}function ct(){return t[7](t[11])}function at(){return t[8](t[9])}return W=new Ct({props:{comments:t[9].children}}),{c(){s=o("article"),g=o("div"),y=o("span"),x=o("a"),D=r(tt),A=c(),T=o("span"),N=r("#"),M=r(et),P=c(),V=o("span"),C=r(nt),R=c(),L=o("span"),U=r(st),H=r(" 条回复"),q=c(),z=o("span"),_=r("回复"),B=c(),J=o("div"),F=c(),G=o("div"),k(W.$$.fragment),Y=c(),this.h()},l(t){s=a(t,"ARTICLE",{id:!0,class:!0});var e=l(s);g=a(e,"DIV",{class:!0});var n=l(g);y=a(n,"SPAN",{class:!0});var o=l(y);x=a(o,"A",{href:!0,class:!0});var r=l(x);D=i(r,tt),r.forEach(h),o.forEach(h),A=u(n),T=a(n,"SPAN",{class:!0,title:!0});var c=l(T);N=i(c,"#"),M=i(c,et),c.forEach(h),P=u(n),V=a(n,"SPAN",{class:!0});var f=l(V);C=i(f,nt),f.forEach(h),R=u(n),L=a(n,"SPAN",{class:!0});var d=l(L);U=i(d,st),H=i(d," 条回复"),d.forEach(h),q=u(n),z=a(n,"SPAN",{class:!0});var m=l(z);_=i(m,"回复"),m.forEach(h),n.forEach(h),B=u(e),J=a(e,"DIV",{class:!0}),l(J).forEach(h),F=u(e),G=a(e,"DIV",{class:!0});var p=l(G);j(W.$$.fragment,p),p.forEach(h),Y=u(e),e.forEach(h),this.h()},h(){var e;f(x,"href",S=null==(e=t[9].user)?void 0:e.website),f(x,"class","svelte-inkkd3"),f(y,"class","ovo-b"),f(T,"class","ovo-s ovo-ptr"),f(T,"title","引用"),f(V,"class","ovo-s"),f(L,"class","ovo-s ovo-a ovo-ptr"),f(z,"class","ovo-s ovo-r ovo-ptr"),f(g,"class","info svelte-inkkd3"),f(J,"class","content svelte-inkkd3"),f(G,"class","details svelte-inkkd3"),d(G,"open",t[2]&1<<t[11]+1),f(s,"id",K="ovo-"+t[9].id),f(s,"class","svelte-inkkd3"),d(s,"active",t[1]&&t[1].slice(5)===t[9].id)},m(t,e){m(t,s,e),p(s,g),p(g,y),p(y,x),p(x,D),p(g,A),p(g,T),p(T,N),p(T,M),p(g,P),p(g,V),p(V,C),p(g,R),p(g,L),p(L,U),p(L,H),p(g,q),p(g,z),p(z,_),p(s,B),p(s,J),J.innerHTML=ot,p(s,F),p(s,G),I(W,G,null),p(s,Y),Q=!0,X||(Z=[v(T,"click",rt),v(L,"click",ct),v(z,"click",at)],X=!0)},p(e,n){var o,r,c;t=e,(!Q||1&n)&&tt!==(tt=(null==(o=t[9].user)?void 0:o.name)+"")&&$(D,tt),(!Q||1&n&&S!==(S=null==(r=t[9].user)?void 0:r.website))&&f(x,"href",S),(!Q||1&n)&&et!==(et=t[9].id+"")&&$(M,et),(!Q||1&n)&&nt!==(nt=At(t[9].ctime)+"")&&$(C,nt),(!Q||1&n)&&st!==(st=((null==(c=t[9].children)?void 0:c.length)||0)+"")&&$(U,st),(!Q||1&n)&&ot!==(ot=t[9].content+"")&&(J.innerHTML=ot);const a={};1&n&&(a.comments=t[9].children),W.$set(a),4&n&&d(G,"open",t[2]&1<<t[11]+1),(!Q||1&n&&K!==(K="ovo-"+t[9].id))&&f(s,"id",K),3&n&&d(s,"active",t[1]&&t[1].slice(5)===t[9].id)},i(t){Q||(w(W.$$.fragment,t),Q=!0)},o(t){E(W.$$.fragment,t),Q=!1},d(t){t&&h(s),O(W),X=!1,b(Z)}}}function Pt(t){let e,n,s,o,r=t[0]&&Nt(t);return{c(){r&&r.c(),e=M()},l(t){r&&r.l(t),e=M()},m(c,a){r&&r.m(c,a),m(c,e,a),n=!0,s||(o=v(window,"hashchange",t[3]),s=!0)},p(t,[n]){t[0]?r?(r.p(t,n),1&n&&w(r,1)):(r=Nt(t),r.c(),w(r,1),r.m(e.parentNode,e)):r&&(H(),E(r,1,1,(()=>{r=null})),q())},i(t){n||(w(r),n=!0)},o(t){E(r),n=!1},d(t){r&&r.d(t),t&&h(e),s=!1,o()}}}function Vt(t,e,n){let{comments:s=[]}=e,o=location.hash;function r(t){at.set(t)}let c=0;function a(t){n(2,c^=1<<t)}return t.$$set=t=>{"comments"in t&&n(0,s=t.comments)},[s,o,c,function(){const t=location.hash;n(1,o=/#ovo-(\d+|[a-z,0-9]{7})/.test(t)?t:"")},r,a,t=>yt.emit("ref",t.id),t=>a(t+1),t=>r(t)]}class Ct extends t{constructor(t){super(),e(this,t,Vt,Pt,n,{comments:0})}}function Rt(t){let e,n,s,d,v,g;return v=new Ct({props:{comments:t[4]}}),{c(){e=o("h3"),n=r("评论 "),s=r(t[3]),d=c(),k(v.$$.fragment),this.h()},l(o){e=a(o,"H3",{class:!0});var r=l(e);n=i(r,"评论 "),s=i(r,t[3]),r.forEach(h),d=u(o),j(v.$$.fragment,o),this.h()},h(){f(e,"class","svelte-2zuo7e")},m(t,o){m(t,e,o),p(e,n),p(e,s),m(t,d,o),I(v,t,o),g=!0},p(t,e){(!g||8&e)&&$(s,t[3]);const n={};16&e&&(n.comments=t[4]),v.$set(n)},i(t){g||(w(v.$$.fragment,t),g=!0)},o(t){E(v.$$.fragment,t),g=!1},d(t){t&&h(e),t&&h(d),O(v,t)}}}function Lt(t){let e,n,s,r,i,d;const v=[{placeholder:t[0]},{emoji:t[1]},t[5]];let $={};for(let o=0;o<v.length;o+=1)$=z($,v[o]);n=new It({props:$});let g=t[4]&&Rt(t);return i=new St({props:{done:t[2]}}),i.$on("visiable",t[6]),{c(){e=o("section"),k(n.$$.fragment),s=c(),g&&g.c(),r=c(),k(i.$$.fragment),this.h()},l(t){e=a(t,"SECTION",{class:!0});var o=l(e);j(n.$$.fragment,o),s=u(o),g&&g.l(o),r=u(o),j(i.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","OvO svelte-2zuo7e")},m(t,o){m(t,e,o),I(n,e,null),p(e,s),g&&g.m(e,null),p(e,r),I(i,e,null),d=!0},p(t,[s]){const o=35&s?_(v,[1&s&&{placeholder:t[0]},2&s&&{emoji:t[1]},32&s&&B(t[5])]):{};n.$set(o),t[4]?g?(g.p(t,s),16&s&&w(g,1)):(g=Rt(t),g.c(),w(g,1),g.m(e,r)):g&&(H(),E(g,1,1,(()=>{g=null})),q());const c={};4&s&&(c.done=t[2]),i.$set(c)},i(t){d||(w(n.$$.fragment,t),w(g),w(i.$$.fragment,t),d=!0)},o(t){E(n.$$.fragment,t),E(g),E(i.$$.fragment,t),d=!1},d(t){t&&h(e),O(n),g&&g.d(),O(i)}}}function Ut(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(o,r){function c(t){try{l(s.next(t))}catch(e){r(e)}}function a(t){try{l(s.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}l((s=s.apply(t,e||[])).next())}))};let{placeholder:o="说点什么吧~"}=e,{emoji:r="https://cdn.jsdelivr.net/gh/DejavuMoe/DejavuMoe/emoji.json"}=e,{server:c="https://www.fastmock.site/mock/112f2e694fa5334c4d698ce22a512405/ovo"}=e,{timeout:a=1e4}=e;Et.init({server:c,timeout:a});const l=new Map;let i,h,u,f,d,m;function p(){n(4,f=null),n(4,f=[]),h=-1,n(3,u=0),n(2,i=!1),l.clear()}return p(),L((function(){const t=localStorage.user;t&&n(5,m=JSON.parse(t))})),U((function(){console.log("OvO was destroyed")})),yt.on("refresh",p),t.$$set=t=>{"placeholder"in t&&n(0,o=t.placeholder),"emoji"in t&&n(1,r=t.emoji),"server"in t&&n(7,c=t.server),"timeout"in t&&n(8,a=t.timeout)},[o,r,i,u,f,m,function(t){return s(this,void 0,void 0,(function*(){if(!i){h++;try{d=yield Et.getComments({domain:location.hostname,path:location.pathname,page:h})}catch(t){throw h--,n(2,i=!0),t}n(2,i=d.done),n(4,f=[...f,...d.comments]),n(3,u=0),l.clear(),Ot(f,(function({user:t}){n(3,u++,u),t&&l.set(t.name,t)})),lt.set(l)}}))},c,a]}class Ht extends t{constructor(t){super(),e(this,t,Ut,Lt,n,{placeholder:0,emoji:1,server:7,timeout:8})}}function qt(t){let e,n,s;return{c(){e=o("input"),this.h()},l(t){e=a(t,"INPUT",{type:!0,class:!0}),this.h()},h(){f(e,"type","checkbox"),f(e,"class","svelte-19wt9bf")},m(o,r){m(o,e,r),e.checked=t[0],n||(s=v(e,"change",t[1]),n=!0)},p(t,[n]){1&n&&(e.checked=t[0])},i:y,o:y,d(t){t&&h(e),n=!1,s()}}}function zt(t,e,n){let{checked:s=!1}=e;return t.$$set=t=>{"checked"in t&&n(0,s=t.checked)},[s,function(){s=this.checked,n(0,s)}]}class _t extends t{constructor(t){super(),e(this,t,zt,qt,n,{checked:0})}}function Bt(t){let e,n,s,d,v,g,b,y,x,D,S,A,T,N,M,P,V,C,L,U,H,q,z,_,B,G,W,Y=t[0]?"开灯":"关灯";function K(e){t[2](e)}let Q={};return void 0!==t[0]&&(Q.checked=t[0]),U=new _t({props:Q}),R.push((()=>J(U,"checked",K))),G=new Ht({props:{server:Jt}}),{c(){e=o("main"),n=o("h1"),s=r("OvO"),d=c(),v=o("h2"),g=r("A Svelte Web Component for Comments"),b=c(),y=o("p"),x=r("Inspired by "),D=o("a"),S=r("OωO"),A=r(". Available on\n    "),T=o("a"),N=r("GitHub"),M=r(". Docs in\n    "),P=o("a"),V=r("README"),C=c(),L=o("div"),k(U.$$.fragment),q=c(),z=o("span"),_=r(Y),B=c(),k(G.$$.fragment),this.h()},l(t){e=a(t,"MAIN",{class:!0});var o=l(e);n=a(o,"H1",{class:!0});var r=l(n);s=i(r,"OvO"),r.forEach(h),d=u(o),v=a(o,"H2",{});var c=l(v);g=i(c,"A Svelte Web Component for Comments"),c.forEach(h),b=u(o),y=a(o,"P",{class:!0});var f=l(y);x=i(f,"Inspired by "),D=a(f,"A",{href:!0,class:!0});var m=l(D);S=i(m,"OωO"),m.forEach(h),A=i(f,". Available on\n    "),T=a(f,"A",{href:!0,class:!0});var p=l(T);N=i(p,"GitHub"),p.forEach(h),M=i(f,". Docs in\n    "),P=a(f,"A",{href:!0,class:!0});var $=l(P);V=i($,"README"),$.forEach(h),f.forEach(h),C=u(o),L=a(o,"DIV",{class:!0});var w=l(L);j(U.$$.fragment,w),q=u(w),z=a(w,"SPAN",{});var E=l(z);_=i(E,Y),E.forEach(h),w.forEach(h),B=u(o),j(G.$$.fragment,o),o.forEach(h),this.h()},h(){f(n,"class","svelte-30a0sp"),f(D,"href","https://github.com/DIYgod/OwO"),f(D,"class","svelte-30a0sp"),f(T,"href","https://github.com/ovojs/OvO"),f(T,"class","svelte-30a0sp"),f(P,"href","https://github.com/ovojs/OvO/blob/main/README.md"),f(P,"class","svelte-30a0sp"),f(y,"class","svelte-30a0sp"),f(L,"class","svelte-30a0sp"),f(e,"class","svelte-30a0sp")},m(t,o){m(t,e,o),p(e,n),p(n,s),p(e,d),p(e,v),p(v,g),p(e,b),p(e,y),p(y,x),p(y,D),p(D,S),p(y,A),p(y,T),p(T,N),p(y,M),p(y,P),p(P,V),p(e,C),p(e,L),I(U,L,null),p(L,q),p(L,z),p(z,_),p(e,B),I(G,e,null),W=!0},p(t,[e]){const n={};!H&&1&e&&(H=!0,n.checked=t[0],F((()=>H=!1))),U.$set(n),(!W||1&e)&&Y!==(Y=t[0]?"开灯":"关灯")&&$(_,Y)},i(t){W||(w(U.$$.fragment,t),w(G.$$.fragment,t),W=!0)},o(t){E(U.$$.fragment,t),E(G.$$.fragment,t),W=!1},d(t){t&&h(e),O(U),O(G)}}}const Jt="https://ovo-svr.ibox.moe";function Ft(t,e,n){let s=!1,o="light";try{o=localStorage.theme,s="dark"===o}catch(r){}return t.$$.update=()=>{if(3&t.$$.dirty){const{classList:t}=document.querySelector("html");t.remove(o),n(1,o=s?"dark":"light"),t.add(o);try{localStorage.theme=o}catch(r){}}},[s,o,function(t){s=t,n(0,s)}]}new class extends t{constructor(t){super(),e(this,t,Ft,Bt,n,{})}}({target:document.getElementById("app")});
